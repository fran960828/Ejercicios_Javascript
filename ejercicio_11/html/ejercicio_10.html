<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link rel="stylesheet" href="../css/style.css" />
    <meta name="description" content="" />

    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <meta property="og:image:alt" content="" />

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="icon.png" />

    <link rel="manifest" href="../site.webmanifest" />
    <meta name="theme-color" content="#fafafa" />
  </head>

  <body>
    <h1>Ejercicio Anotador</h1>
    <ul>
      <li><a href="../index.html">Volver</a></li>
    </ul>
    <script>
      /*
      ## Chat con Usuarios y Mensajes

  ### Usuario
  - **Propiedades**
    - id (string)
    - nombre (string)
  - **Constructor**
    - genera un `id` automático y lo asigna a su propiedad
    - el resto de propiedades las pide como argumentos y las asigna según corresponda
  - **Métodos**
    - getters para obtener los valores de todas las propiedades

  ### Mensaje
  - **Propiedades**
    - remitente (Usuario)
    - destinatario (Usuario)
    - texto (string)
    - fecha (Date), inicializa con la fecha actual (`new Date()`)
  - **Constructor**
    - pide las propiedades no inicializadas como argumentos y las asigna según corresponda
  - **Métodos**
    - getters para obtener los valores de todas las propiedades

  ### Chat
  - **Propiedades**
    - usuario (`Usuario`)
    - contactos (array de `Usuario`), inicializa vacío
    - mensajes (array de `Mensaje`), inicializa vacío
  - **Constructor**
    - pide `usuario` como argumento y lo agrega a su respectiva propiedad
  - **Métodos**
    - **`agregarContacto(usuario)`** agregar `usuario` a `contactos`
    - **`obtenerContactos()`** devuelve un array con la lista de `contactos`
    - **`obtenerMensaje()`** devuelve un array con la lista de `mensajes`
    - **`filtrarPorContacto(id)`** devuelve un array con la lista de `mensajes` que tienen como `destinatario` un usuario con `id`
    - **`filtrarPorFecha(fecha)`** devuelve un array con la lista de `mensajes` que tienen `fecha` (mismo día, mes y año)
    - **`mandarMensaje(mensaje)`** agrega `mensaje` a `mensajes`, si `destinatario` es un usuario de la lista de contactos con y si `mensaje` no se encuentra ya en el array de `mensajes`
  - **Observaciones**
    - solo se pueden mandar mensajes a usuarios de la lista de `contactos`. En caso contrario, arrojar un error.
    <br>
*/
class Usuario{
  #id;
  #nombre;
  constructor(nombre){
    this.#id=crypto.randomUUID();
    this.#nombre=nombre;
  }
  getId(){
    return this.#id;
  }
  getNombre(){
    return this.#nombre;
  }
}
class Mensaje {
  #remitente;
  #destinatario;
  #mensaje;
  #fecha;
  constructor(remitente,destinatario,mensaje,fecha){
    this.#remitente=remitente;
    this.#destinatario=destinatario;
    this.#mensaje=mensaje;
    this.#fecha=fecha;
  }
  getRemitente(){
    return this.#remitente;
  }
  getDestinatario(){
    return this.#destinatario;
  }
  getMensaje(){
    return this.#mensaje;
  }
  getFecha(){
    return this.#fecha;
  }
}
class Chat{
  #usuario;
  #contactos;
  #mensajes;
  constructor(usuario){
    this.#usuario=usuario;
    this.#contactos=[];
    this.#mensajes=[];
  }
  agregarContacto(usuario){
    if (!(usuario instanceof Usuario)) {
      throw new Error("El contacto debe ser un objeto de tipo Usuario");
    }
    this.#contactos.push(usuario);
  }
  obtenerContactos(){
    return this.#contactos.map((contacto)=>contacto.getNombre())
  }
  obtenerMensajes(){
    return this.#mensajes.map((mensaje)=>{
      return `remitente:${mensaje.getRemitente().getNombre()}
      destinatario:${mensaje.getDestinatario().getNombre()}
      fecha:${mensaje.getFecha()}
      mensaje:${mensaje.getMensaje()}`
    })
  }
  filtrarPorContacto(id) {
  return this.#mensajes
    .filter(
      (mensaje) =>
        mensaje.getDestinatario().getId() === id ||
        mensaje.getRemitente().getId() === id
    )
    .map((mensaje) => {
      return {
        remitente: mensaje.getRemitente().getNombre(),
        destinatario: mensaje.getDestinatario().getNombre(),
        fecha: mensaje.getFecha(),
        mensaje: mensaje.getMensaje()
      };
    });
}
  filtrarPorFecha(fecha){
    return this.#mensajes.filter((mensaje)=>new Date(mensaje.getFecha()).toDateString()===new Date(fecha).toDateString()
  ).map((mensaje)=>{
    return {
        remitente: mensaje.getRemitente().getNombre(),
        destinatario: mensaje.getDestinatario().getNombre(),
        fecha: mensaje.getFecha(),
        mensaje: mensaje.getMensaje()
      }; 
  })}
   mandarMensaje(mensaje) {
    if (!(mensaje instanceof Mensaje)) {
      throw new Error("El mensaje debe ser una instancia de Mensaje");
    }
    const destinatario = this.#contactos.find(
      (contacto) => contacto.getId() === mensaje.getDestinatario().getId()
    );

    if (!destinatario) {
      throw new Error('El destinatario no está en tu lista de contactos');
    } else {
      this.#mensajes.push(mensaje);
    }
  }
}
const alice = new Usuario("Alice");
const bob = new Usuario("Bob");

const chat = new Chat(alice);
chat.agregarContacto(bob);
console.log(chat.obtenerContactos())

const mensaje1 = new Mensaje(alice, bob, "¡Hola Bob!",'06-09-2025');
chat.mandarMensaje(mensaje1);

console.log(chat.obtenerMensajes());
console.log(chat.filtrarPorContacto(bob.getId()));
console.log(chat.filtrarPorFecha('06-09-2025'));


    </script>
  </body>
</html>
