<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link rel="stylesheet" href="../css/style.css" />
    <meta name="description" content="" />

    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <meta property="og:image:alt" content="" />

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="icon.png" />

    <link rel="manifest" href="../site.webmanifest" />
    <meta name="theme-color" content="#fafafa" />
  </head>

  <body>
    <h1>Ejercicio Twitter</h1>
    <ul>
      <li><a href="../index.html">Volver</a></li>
    </ul>
    <script>
      /*

## Twitter con Tweets y Usuarios

  ### Usuario
  - **Propiedades**
    - handle (string)
    - siguiendo (array de `Usuario`), inicializa vacío
  - **Constructor**
    - pide `handle` como argumento y lo agrega a su respectiva propiedad
  - **Métodos**
    - **`seguir(usuario)`** agrega `usuario` a `siguiendo`, *si no se encuentra ya en dicho array* y *si no es el propio  usuario* (no se puede seguir a sí mismo)
    - getters para obtener los valores de todas las propiedades

  ### Tweet
  - **Propiedades**
    - id (string)
    - handle (`string`)
    - texto (string)
    - likes (array de `Usuario`), inicializa en 0
    - retweets (array de `Usuario), inicializa en 0
  - **Constructor**
    - genera un `id` automático y lo asigna a su propiedad
    - pide `handle` y `texto` como argumentos y los agrega a sus respectivas propiedades
  - **Métodos**
    - getters para obtener los valores de todas las propiedades
    - **`darLike(usuario)`** agrega `usuario` a `likes`, *si ya se encuentra en dicho array, debe removerlo de mismo*
    - **`retweetear(usuario)`** agrega `usuario` a `retweets`, *si ya se encuentra en dicho array, debe removerlo de mismo*

  ### Twitter
  - **Propiedades**
    - tweets (array de `Tweet`), inicializa vacío
  - **Métodos**
    - **`twittear(tweet)`** agrega `tweet` a `tweets`, *si dicho `tweet` no se encuentra actualmente en el array*
    - **`obtenerTimeline(usuario)`** devuelve un array de tweets del `usuario`. Este array se compone de
      - todos los tweets publicados por los usuarios que sigue
      - todos los tweets likeados por los usuarios que sigue
      - todos los tweets retweeteados por los usuarios que sigue
      - no debe haber tweets repetidos
      - deben estar ordenados de más nuevos a más viejos
  - **Observaciones**
    - Es recomendable crear métodos privados para simplificar `obtenerTimeline`          */
      class Usuario {
        #handle;
        #siguiendo;
        constructor(handle) {
          this.#handle = handle;
          this.#siguiendo = [];
        }
        getHandle() {
          return this.#handle;
        }
        getSiguiendo() {
          return this.#siguiendo.map((user) => user.getHandle());
        }
        seguir(usuario) {
          if (!(usuario instanceof Usuario)) {
            throw new Error("Solo puedes seguir a objetos de tipo Usuario");
          }

          const yaSigue = this.#siguiendo.some(
            (user) => user.getHandle() === usuario.getHandle()
          );

          if (yaSigue || this.getHandle() === usuario.getHandle()) {
            console.warn(
              `${this.getHandle()} no puede seguir a ${usuario.getHandle()}`
            );
            return;
          }

          this.#siguiendo.push(usuario);
        }
      }
      class Tweet {
        #id;
        #autor;
        #texto;
        #likes;
        #retweets;
        #fecha;

        constructor(usuario, texto) {
          if (!(usuario instanceof Usuario)) {
            throw new Error("El autor debe ser un objeto de tipo Usuario");
          }
          this.#id = crypto.randomUUID();
          this.#autor = usuario;
          this.#texto = texto;
          this.#likes = [];
          this.#retweets = [];
          this.#fecha = new Date();
        }

        getId() {
          return this.#id;
        }

        getAutor() {
          return this.#autor.getHandle();
        }

        getTexto() {
          return this.#texto;
        }

        getLikes() {
          return this.#likes.map((user) => user.getHandle());
        }

        getRetweets() {
          return this.#retweets.map((user) => user.getHandle());
        }
        getFecha() {
          return this.#fecha;
        }

        toggleLike(usuario) {
          if (!(usuario instanceof Usuario)) {
            throw new Error("Solo un Usuario puede dar like");
          }
          const index = this.#likes.findIndex(
            (user) => usuario.getHandle() === user.getHandle()
          );
          if (index !== -1) {
            this.#likes.splice(index, 1); // quitar like
          } else {
            this.#likes.push(usuario); // dar like
          }
        }

        toggleRetweet(usuario) {
          if (!(usuario instanceof Usuario)) {
            throw new Error("Solo un Usuario puede retweetear");
          }
          const index = this.#retweets.findIndex(
            (user) => usuario.getHandle() === user.getHandle()
          );
          if (index !== -1) {
            this.#retweets.splice(index, 1); // quitar retweet
          } else {
            this.#retweets.push(usuario); // hacer retweet
          }
        }
      }
      class Twitter {
        #tweets;
        constructor() {
          this.#tweets = [];
        }
        obtenerTweetsPublicadosPor(usuario) {
          return this.#tweets.filter(
            (tweet) => tweet.getAutor() === usuario.getHandle()
          );
        }
        obtenerTweetsLikeadosPor(usuario) {
          return this.#tweets.filter((tweet) => {
            return tweet.getLikes().includes(usuario.getHandle());
          });
        }
        obtenerTweetsRetweeteadosPor(usuario) {
          return this.#tweets.filter((retweet) => {
            return retweet.getRetweets().includes(usuario.getHandle());
          });
        }
        removerDuplicados(lista) {
          return [...new Set(lista)];
        }

        twittear(tweet) {
          if (!(tweet instanceof Tweet)) {
            throw new Error("Solo un Tweet puede ser registrado");
          }
          this.#tweets.push(tweet);
        }
        obtenerTimeLine(usuario) {
          const listaCompleta = [
            ...this.obtenerTweetsPublicadosPor(usuario),
            ...this.obtenerTweetsLikeadosPor(usuario),
            ...this.obtenerTweetsRetweeteadosPor(usuario),
          ];
          const listaSinDuplicados = this.removerDuplicados(listaCompleta);
          return listaSinDuplicados.sort(
            (a, b) => new Date(b.getFecha()) - new Date(a.getFecha())
          );
        }
      }

      // Crear usuarios
      const alice = new Usuario("alice");
      const bob = new Usuario("bob");
      const carol = new Usuario("carol");

      // Relaciones de seguimiento
      alice.seguir(bob);
      alice.seguir(carol);

      // Instanciar Twitter
      const twitter = new Twitter();

      // Bob y Carol publican tweets
      const t1 = new Tweet(bob, "Hola, soy Bob!");
      const t2 = new Tweet(carol, "Buenos días desde Carol ☀️");
      const t3 = new Tweet(carol, "Otro tweet de Carol");

      twitter.twittear(t1);
      twitter.twittear(t2);
      twitter.twittear(t3);

      // Bob da like al tweet de Carol
      t2.toggleLike(bob);

      // Carol retweetea el tweet de Bob
      t1.toggleRetweet(carol);

      // PROBAR MÉTODOS

      // Timeline de Alice (sigue a Bob y Carol)
      console.log("Timeline de Alice:");
      twitter.obtenerTimeLine(alice);
    </script>
  </body>
</html>
